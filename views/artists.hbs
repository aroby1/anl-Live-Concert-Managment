<div class="container">
    <!-- Section: List of Artists -->
    <h2>List of Artists</h2>
    <table id="artist-table">
        <thead>
            <tr>
                <th>Artist ID</th> <!-- Column for Artist ID -->
                <th>Artist Name</th> <!-- Column for Artist Name -->
                <th colspan="2">Actions</th> <!-- Column for action buttons -->
            </tr>
        </thead>
        <tbody>
            <!-- Dynamically generate rows for each artist in the data -->
            {{#each data}}
                <tr data-id="{{this.artistID}}" data-name="{{this.artistName}}">
                    <td>{{this.artistID}}</td> <!-- Display Artist ID -->
                    <td>{{this.artistName}}</td> <!-- Display Artist Name -->
                    <!-- Edit button -->
                    <td><a href="#" class="edit-btn">Edit</a></td>
                    <!-- Delete button -->
                    <td><a href="#" class="delete-btn">Delete</a></td>
                </tr>
            {{/each}}
        </tbody>
    </table>

    <!-- Section: Add Artist Form -->
    <h3>Add Artist</h3>
    <form id="add-artist-form" action="/add-artist-form" method="POST">
        <!-- Input field for artist name -->
        <label for="addArtistName">Artist Name:</label>
        <input type="text" id="addArtistName" name="artistName" placeholder="Enter artist name" required><br>
        <!-- Submit button to add an artist -->
        <input type="submit" value="Add Artist">
    </form>
</div>

<!-- Popup Menu for Editing Artist -->
<div id="popupMenu" class="popup">
  <div class="popup-content">
    <!-- Close button -->
    <span id="closePopup" class="close">&times;</span>
    <h3>Update Artist</h3>
    <form id="update-artist-form" method="POST">
        <!-- Hidden field to store the artist ID -->
        <input type="hidden" id="updateArtistID" name="artistID">
        <!-- Input field for editing artist name -->
        <label for="updateArtistName">Artist Name:</label>
        <input type="text" id="updateArtistName" name="artistName" placeholder="Enter artist name" required><br>
        <!-- Submit button to update artist -->
        <input type="submit" value="Update Artist">
    </form>
    <!-- Close popup button -->
    <button id="closeButton">Close</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // Select buttons and elements for actions
    const deleteButtons = document.querySelectorAll(".delete-btn");
    const editButtons = document.querySelectorAll(".edit-btn");
    const popupMenu = document.getElementById("popupMenu");
    const closePopup = document.getElementById("closePopup");
    const closeButton = document.getElementById("closeButton");
    const updateArtistForm = document.getElementById("update-artist-form");
    const updateArtistID = document.getElementById("updateArtistID");
    const updateArtistName = document.getElementById("updateArtistName");

    // Handle Delete Button Click
    deleteButtons.forEach(button => {
        button.addEventListener("click", async function (event) {
            event.preventDefault();

            // Get the row and artist ID
            const row = button.closest("tr");
            const artistId = row.getAttribute("data-id");

            try {
                // Send DELETE request to the server
                const response = await fetch(`/delete-artist/${artistId}`, {
                    method: 'DELETE',
                });
                if (response.ok) {
                    row.remove(); // Remove row from the table on success
                } else {
                    console.error("Failed to delete artist");
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });
    });

    // Handle Edit Button Click
    editButtons.forEach(button => {
        button.addEventListener("click", (event) => {
            event.preventDefault();

            // Get artist details from the row's attributes
            const row = button.closest("tr");
            const artistId = row.getAttribute("data-id");
            const artistName = row.getAttribute("data-name");

            // Populate the form fields with the artist's details
            updateArtistID.value = artistId;
            updateArtistName.value = artistName;

            // Set form action to the specific update URL
            updateArtistForm.action = `/update-artist-form/${artistId}`;

            // Display the popup menu
            popupMenu.style.display = "flex";
        });
    });

    // Close Popup Menu when clicking the close icon
    closePopup.addEventListener("click", () => {
        popupMenu.style.display = "none";
    });

    // Close Popup Menu when clicking the close button
    closeButton.addEventListener("click", () => {
        popupMenu.style.display = "none";
    });

    // Close Popup Menu when clicking outside the content area
    window.addEventListener("click", (event) => {
        if (event.target === popupMenu) {
            popupMenu.style.display = "none";
        }
    });
});
</script>
