<div class="container">
    <h2>List of Vendors Available at a Concert</h2>
        <table>
            <thead>
                <tr>
                {{#each data.[0]}}
                    <th>
                        {{@key}}
                    </th>
                    {{/each}}
                    <th colspan="2">Actions</th>
                </tr>
            </thead>           
        <tbody>
            {{#each data}}
                <tr data-id = {{"this.concertVendorID"}}>
                    <td>{{this.concertVendorID}}</td>
                    <td>{{this.concertID}}</td>
                    <td>{{this.vendorID}}</td>
                    <td><a href="#" class="edit-btn">Edit</a></td>
                    <td><a href="#" class="delete-btn">Delete</a></td>
                </tr>
            {{/each}}
        </tbody>
    </table>

    <!-- Add Form -->
    <h3>Add a Vendor Available at a Concert</h3>
    <p>To add a new vendor available at a concert, please select the vendor's name and concert location below, then click 'Add Vendor Available at a Concert'!</p>
    <form id="add-vendor-at-concert-form" action="/add-vendor-at-concert-form" method="POST">
        <label for="concertLocation">Concert Location:</label>
        <select id="concertLocation" name="concertLocation" required>
            <option value="">Select Concert Location</option>
            {{#each concerts}}
                <option value="{{this.concertID}}">{{this.location}}</option>
            {{/each}}
        </select><br>

        <label for="vendorName">Vendor Name:</label>
        <select id="vendorName" name="vendorName" required>
            <option value="">Select Vendor</option>
            {{#each vendors}}
                <option value="{{this.vendorID}}">{{this.vendorName}}</option>
            {{/each}}
        </select><br>

        <input type="submit" value="Add Vendor Available at a Concert">
    </form>
        
<div id="popupMenu" class="popup">
<div class="popup-content">
    <form id="add-vendor-at-concert-form" action="/update-vendor-at-concert-form" method="POST">
        <label for="concertLocation">Concert Location:</label>
        <select id="concertLocation" name="concertLocation" required>
            <option value="">Select Concert Location</option>
            {{#each concerts}}
                <option value="{{this.concertID}}">{{this.location}}</option>
            {{/each}}
        </select><br>

        <label for="vendorName">Vendor Name:</label>
        <select id="vendorName" name="vendorName" required>
            <option value="">Select Vendor</option>
            {{#each vendors}}
                <option value="{{this.vendorID}}">{{this.vendorName}}</option>
            {{/each}}
        </select><br>

        <input type="submit" value="Update Vendor Available at a Concert">
<span id="closePopup" class="close">&times;</span>
<button id="closeButton">Close</button>
</div>
</div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const deleteButtons = document.querySelectorAll(".delete-btn");
    const editButtons = document.querySelectorAll(".edit-btn");
    const popupMenu = document.getElementById("popupMenu");
    const closePopup = document.getElementById("closePopup");
    const closeButton = document.getElementById("closeButton");

    deleteButtons.forEach(button => {
        button.addEventListener("click", async function (event) {
            event.preventDefault();

            const row = button.closest("tr");
            const artistId = row.getAttribute("data-id");
            row.remove(); 

            try {
                const response = await fetch(`/delete-concert-vendor/${artistId}`, {
                    method: 'DELETE',
                });
            } catch (error) {
                console.error("Error:", error);
            }
        });
    });
        // Open Popup Menu on Edit
    editButtons.forEach(button => {
        button.addEventListener("click", (event) => {
            event.preventDefault();
            popupMenu.style.display = "flex";
        });
    });

    // Close Popup Menu
    closePopup.addEventListener("click", () => {
        popupMenu.style.display = "none";
    });

    closeButton.addEventListener("click", () => {
        popupMenu.style.display = "none";
    });

    // Close Popup Menu when clicking outside the content area
    window.addEventListener("click", (event) => {
        if (event.target === popupMenu) {
            popupMenu.style.display = "none";
        }
    });
});
</script>
